<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>TheRoadApp - Smart Mobility</title>
  <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css"/>
  <link href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@400;500;700&display=swap" rel="stylesheet">
  <style>
    /* same styles as you pasted above */
  </style>
</head>
<body>
  <!-- Tabs -->
  <div class="tabs">
    <div class="tab active" data-target="home-section">Home</div>
    <div class="tab" data-target="road-health-section">Road Health</div>
  </div>

  <!-- Homepage -->
  <div id="home-section" class="section active">
    <h1>üöç TheRoadApp</h1>
    <p>Search your bus and track it in real-time.</p>
    <button id="report-hazard-btn" class="btn-danger" style="width:100%; margin-top:18px;">Report Hazard</button>
    <div id="map" style="height:60vh; margin-top:20px; border-radius:14px;"></div>
  </div>

  <!-- Road Health Section -->
  <div id="road-health-section" class="section">
    <h1>üõ£Ô∏è Road Health</h1>
    <p>Check road condition before your journey.</p>
    <div id="road-health-map" style="height:65vh; margin-top:18px; border-radius:14px;"></div>
  </div>

  <!-- Modal -->
  <div id="modal" class="modal-overlay">
    <div class="modal" role="dialog" aria-modal="true">
      <h3>Report Hazard</h3>
      <div class="form-group">
        <label>Type of hazard</label>
        <select id="hazard-type">
          <option value="pothole">Pothole</option>
          <option value="obstruction">Obstruction</option>
          <option value="water_logging">Water logging</option>
          <option value="accident">Accident</option>
          <option value="other">Other</option>
        </select>
      </div>
      <div class="form-group">
        <label>Description</label>
        <textarea id="hazard-desc" rows="3"></textarea>
      </div>
      <div class="form-group">
        <label>Location</label>
        <input type="text" id="hazard-loc" readonly>
      </div>
      <div class="actions">
        <button class="btn-secondary" id="cancel-modal">Cancel</button>
        <button class="btn-primary" id="submit-hazard">Submit</button>
      </div>
    </div>
  </div>

  <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
  <script type="module">
    // === CONFIG ===
    const SUPABASE_URL = "https://jnjhkmlvfmynxyjypyie.supabase.co";
    const PUBLIC_KEY = "YOUR_ANON_KEY"; // commuters use anon key safely

    // Tabs
    document.querySelectorAll(".tab").forEach(tab=>{
      tab.onclick=()=>{
        document.querySelectorAll(".tab").forEach(t=>t.classList.remove("active"));
        document.querySelectorAll(".section").forEach(s=>s.classList.remove("active"));
        tab.classList.add("active");
        document.getElementById(tab.dataset.target).classList.add("active");
      };
    });

    // Map init
    const map = L.map("map").setView([20,77], 5);
    L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",{maxZoom:19}).addTo(map);

    // Hazard modal
    const modal=document.getElementById("modal");
    document.getElementById("report-hazard-btn").onclick=()=>{
      modal.style.display="flex";
      navigator.geolocation.getCurrentPosition(pos=>{
        document.getElementById("hazard-loc").value =
          `${pos.coords.latitude}, ${pos.coords.longitude}`;
      });
    };
    document.getElementById("cancel-modal").onclick=()=>modal.style.display="none";

    // Submit hazard
    document.getElementById("submit-hazard").onclick=async()=>{
      const loc=document.getElementById("hazard-loc").value.split(",");
      const payload={
        type:document.getElementById("hazard-type").value,
        description:document.getElementById("hazard-desc").value,
        latitude:parseFloat(loc[0]),
        longitude:parseFloat(loc[1]),
        reported_at:new Date().toISOString()
      };

      try{
        const res=await fetch(`${SUPABASE_URL}/rest/v1/hazards`,{
          method:"POST",
          headers:{
            apikey:PUBLIC_KEY,
            Authorization:`Bearer ${PUBLIC_KEY}`,
            "Content-Type":"application/json",
            Prefer:"return=minimal"
          },
          body:JSON.stringify(payload)
        });
        if(res.ok){ alert("‚úÖ Hazard reported!"); modal.style.display="none"; }
        else{ alert("‚ùå Failed: "+await res.text()); }
      }catch(e){ alert("Error: "+e.message); }
    };
  </script>
</body>
</html>
